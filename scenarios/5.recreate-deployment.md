# Scenario: Recreate Deployment Strategy

## Goal

Learn how the Recreate deployment strategy works and when to use it.

## What is Recreate Strategy?

The Recreate strategy:
- Terminates all old pods first
- Then creates new pods
- Results in downtime during deployment
- Useful when you cannot run two versions simultaneously

## Steps

1. **Update deployment to use Recreate strategy**:
   
   Edit `app/deployment.yaml` and add the strategy:
   ```yaml
   apiVersion: apps/v1
   kind: Deployment
   metadata:
     name: demo-app
     namespace: demo
   spec:
     replicas: 2
     strategy:
       type: Recreate
     selector:
       matchLabels:
         app: demo-app
     template:
       metadata:
         labels:
           app: demo-app
       spec:
         containers:
         - name: nginx
           image: nginx:1.25
           ports:
           - containerPort: 80
   ```

2. **Commit and push**:
   ```bash
   git add app/deployment.yaml
   git commit -m "Add Recreate deployment strategy"
   git push
   ```

3. **Wait for Argo CD to sync**

4. **Now update the nginx version**:
   ```bash
   # Change image from nginx:1.25 to nginx:1.26
   git add app/deployment.yaml
   git commit -m "Update nginx version with Recreate strategy"
   git push
   ```

5. **Watch the deployment behavior**:
   ```bash
   kubectl get pods -n demo -w
   ```
   
   You'll see:
   - All old pods terminate immediately
   - Brief period with NO running pods (downtime)
   - New pods start creating
   - New pods become ready

6. **Test during deployment**:
   
   In another terminal, continuously curl the service:
   ```bash
   while true; do curl -s http://$(minikube ip):30080 && echo " - OK" || echo " - FAILED"; sleep 1; done
   ```
   
   You'll see connection failures during the deployment.

## Expected Behavior

- Argo CD syncs the change
- Kubernetes terminates all pods
- Brief downtime occurs
- New pods start
- Application becomes available again

## Learning Outcome

**Recreate = Downtime**

Use Recreate strategy when:
- You cannot run two versions at the same time
- Database schema changes require stopping the app
- Testing scenarios where clean slate is needed

Avoid for production services that require high availability.

## Compare with RollingUpdate

To see the difference, change strategy back to RollingUpdate:
```yaml
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 1
    maxSurge: 1
```

Now deployments will have zero downtime!
